<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avaliação de Empresas Jovens com Python — FCD no navegador</title>
  <meta name="description" content="Página standalone que executa Python no navegador via Pyodide. Implementação prática de FCD para empresas jovens.">
  <style>
    :root{--bg:#0b1220;--panel:#111a2b;--panel2:#0f1626;--muted:#b9c2d0;--text:#e8eefc;--accent:#4ea1ff}
    html,body{background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.6;margin:0}
    .wrap{max-width:1100px;margin:0 auto;padding:24px 14px}
    h1{font-size:1.9rem;margin:0 0 8px}
    h2{font-size:1.35rem;margin:18px 0 8px}
    p,li{color:#d7e2f4}
    .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid rgba(255,255,255,.08);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:14px;margin:16px 0}
    .cell{border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.08);margin-top:12px}
    .cell-head{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:10px 12px;background:rgba(255,255,255,.05);border-bottom:1px solid rgba(255,255,255,.06)}
    .cell-title{font-weight:700}
    .cell-status{font-size:.85rem;color:var(--muted)}
    .cell-run{appearance:none;border:0;border-radius:10px;background:var(--accent);color:#041022;font-weight:800;padding:9px 13px;cursor:pointer}
    .cell-run[disabled]{opacity:.6;cursor:not-allowed}
    textarea{width:100%;min-height:160px;resize:vertical;color:#e5efff;background:#0b1424;border:none;outline:none;padding:14px;line-height:1.4;font-size:.92rem;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .out{background:#07101f;border-top:1px solid rgba(255,255,255,.06);padding:12px;font-family:ui-monospace,Consolas,Menlo,monospace;color:#d6e3ff;white-space:pre-wrap;overflow-x:auto;min-height:42px}
    .out img{max-width:100%;border-radius:10px;display:block;margin:12px 0}
    .notice{border-left:4px solid var(--accent);padding:10px 12px;background:rgba(78,161,255,.08);border-radius:10px;margin:8px 0}
    .hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.14),transparent);margin:22px 0}
  </style>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Avaliação de Empresas Jovens com Python, implementação prática do FCD</h1>
      <div class="notice">
        Use as células abaixo, edite e clique em Rodar. Para gráficos, a célula deve terminar com <code>figb64()</code>, o gráfico aparece logo abaixo. Tudo roda no navegador.
      </div>
    </header>

    <section class="panel">
      <h2>Setup do ambiente</h2>
      <p>Inicializa Pyodide, carrega NumPy e Matplotlib, valida versões e gera um gráfico simples.</p>
      <div class="cell" id="cell-setup">
        <div class="cell-head">
          <div class="cell-title">Python</div>
          <div class="cell-status" data-status>carregando…</div>
          <button class="cell-run" data-run disabled>Rodar</button>
        </div>
<textarea spellcheck="false">import sys, numpy as np, matplotlib, matplotlib.pyplot as plt
print("Python:", sys.version.split()[0])
print("NumPy:", np.__version__)
print("Matplotlib:", matplotlib.__version__)
x = np.linspace(0,6.28,200)
y = np.sin(x)
plt.plot(x,y); plt.title("Seno")
figb64()</textarea>
        <div class="out" data-out>(aguardando)</div>
      </div>
    </section>

    <div class="hr"></div>

    <section class="panel">
      <h2>FCD básico, empresa jovem</h2>
      <p>Premissas simples para aula, ajuste como quiser.</p>
      <div class="cell">
        <div class="cell-head">
          <div class="cell-title">Python</div>
          <div class="cell-status" data-status>ok</div>
          <button class="cell-run" data-run disabled>Rodar</button>
        </div>
<textarea spellcheck="false"># Parâmetros
anos = 10
receita0 = 2.0e6
crec = [0.5,0.45,0.4,0.35,0.3,0.25,0.2,0.18,0.16,0.15]
margem_ebitda = [-0.30,-0.20,-0.10,0.05,0.10,0.15,0.18,0.20,0.22,0.25]
capex_sobre_receita = 0.06
nwc_sobre_receita = 0.08
aliquota = 0.0
wacc = 0.20

# Projeção de receitas
receita=[receita0]
for t in range(anos):
    receita.append(receita[-1]*(1+crec[t]))
receita=receita[1:]

import numpy as np, matplotlib.pyplot as plt

# Demonstração
ebitda=[r*m for r,m in zip(receita,margem_ebitda)]
dep=[0.03*r for r in receita]
ebite=[e-d for e,d in zip(ebitda,dep)]

lucro_oper=[]; imposto=[]; prejuizo_acum=0.0
for e in ebite:
    base = e - max(prejuizo_acum,0)
    imp = max(base,0)*aliquota
    imposto.append(imp)
    lucro_oper.append(e-imp)
    prejuizo_acum += min(e,0)

nwc=[nwc_sobre_receita*r for r in receita]
capex=[capex_sobre_receita*r for r in receita]

fcl=[]
for t in range(anos):
    delta_nwc = nwc[t] - (nwc[t-1] if t>0 else 0)
    fcl.append(lucro_oper[t] + dep[t] - capex[t] - delta_nwc)

# Valor terminal em perpetuidade
g=0.04
vt=fcl[-1]*(1+g)/(wacc-g)

# Desconto
fc_desc=[f/((1+wacc)**(t+1)) for t,f in enumerate(fcl)]
vt_desc=vt/((1+wacc)**anos)
valor_empre=sum(fc_desc)+vt_desc
print(f"Valor da firma, R$ {valor_empre:,.0f}")

# Gráfico do FCL
plt.figure(figsize=(6.6,3.6))
plt.plot(range(1,anos+1), fcl, marker='o')
plt.title('Fluxo de Caixa Livre projetado')
plt.xlabel('Ano'); plt.ylabel('R$')
figb64()</textarea>
        <div class="out" data-out>(aguardando)</div>
      </div>
    </section>

    <div class="hr"></div>

    <section class="panel">
      <h2>Sensibilidade WACC × g</h2>
      <p>Mapa rápido de valor com WACC e crescimento terminal.</p>
      <div class="cell">
        <div class="cell-head">
          <div class="cell-title">Python</div>
          <div class="cell-status" data-status>ok</div>
          <button class="cell-run" data-run disabled>Rodar</button>
        </div>
<textarea spellcheck="false">import numpy as np, matplotlib.pyplot as plt

def valor_firma_wacc_g(fcl, anos, wacc, g):
    vt = fcl[-1]*(1+g)/(wacc-g)
    fc_desc=[f/((1+wacc)**(t+1)) for t,f in enumerate(fcl)]
    vt_desc=vt/((1+wacc)**anos)
    return sum(fc_desc)+vt_desc

# Reusa fcl/anos se vier da célula anterior, caso contrário cria exemplo
try:
    fcl
    anos
except NameError:
    fcl=[-1e6,-5e5,2e5,6e5,1.1e6,1.6e6,2.0e6,2.4e6,2.7e6,3.0e6]
    anos=len(fcl)

wacc_grid=np.linspace(0.14,0.28,8)
g_grid=np.linspace(0.01,0.05,5)
mat=np.zeros((len(wacc_grid),len(g_grid)))
for i,w in enumerate(wacc_grid):
    for j,g in enumerate(g_grid):
        mat[i,j]=valor_firma_wacc_g(fcl, anos, w, g)

plt.figure(figsize=(6.5,4.2))
plt.imshow(mat,origin='lower',aspect='auto')
plt.xticks(range(len(g_grid)),[f"{g:.2%}" for g in g_grid])
plt.yticks(range(len(wacc_grid)),[f"{w:.0%}" for w in wacc_grid])
plt.xlabel('g terminal'); plt.ylabel('WACC'); plt.title('Sensibilidade do Valor da Firma')
txt = f"Exemplo, WACC 22%, g 3%: {round(valor_firma_wacc_g(fcl, anos, 0.22, 0.03))}"
print(txt)
figb64()</textarea>
        <div class="out" data-out>(aguardando)</div>
      </div>
    </section>

    <footer style="opacity:.75;margin-top:26px">
      <small>Roda localmente via Pyodide. O primeiro carregamento pode demorar um pouco.</small>
    </footer>
  </div>

  <script>
    let PY = null;

    async function boot(){
      const cells = document.querySelectorAll('.cell');
      const firstStatus = cells[0].querySelector('[data-status]');
      try{
        firstStatus.textContent = 'baixando pacotes…';
        PY = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.25.1/full/" });
        await PY.loadPackage(["numpy","matplotlib"]);
        // helper de gráficos: showfig() escreve em stdout; figb64() retorna string
        await PY.runPythonAsync(`
import matplotlib
matplotlib.use('agg')
import matplotlib.pyplot as plt
import io, base64, sys
def showfig():
    buf = io.BytesIO()
    plt.tight_layout()
    plt.savefig(buf, format='png', dpi=160, bbox_inches='tight')
    buf.seek(0)
    sys.stdout.write('__IMG__' + base64.b64encode(buf.getvalue()).decode('ascii'))
    plt.close('all')
def figb64():
    buf = io.BytesIO()
    plt.tight_layout()
    plt.savefig(buf, format='png', dpi=160, bbox_inches='tight')
    buf.seek(0)
    s = '__IMG__' + base64.b64encode(buf.getvalue()).decode('ascii')
    plt.close('all')
    return s
`);
        document.querySelectorAll('.cell .cell-run').forEach(b => b.disabled = false);
        document.querySelectorAll('.cell [data-status]').forEach(s => s.textContent = 'ok');
      }catch(e){
        firstStatus.textContent = 'erro ao carregar, ' + (e && e.message ? e.message : e);
        console.error(e);
      }
    }

    function attach(){
      document.querySelectorAll('.cell').forEach(cell => {
        const run = cell.querySelector('[data-run]');
        const out = cell.querySelector('[data-out]');
        const status = cell.querySelector('[data-status]');
        const ta = cell.querySelector('textarea');
        run.addEventListener('click', async () => {
          if(!PY) return;
          run.disabled = true; status.textContent = 'executando…'; out.textContent = '';
          let buf = '';
          const o1 = PY.setStdout({ batched: s => buf += s });
          const o2 = PY.setStderr({ batched: s => buf += s });
          let ret = '';
          try {
            ret = await PY.runPythonAsync(ta.value); // captura retorno (figb64)
          } catch(e) {
            buf += '\nErro: ' + (e && e.message ? e.message : e);
          } finally {
            PY.setStdout(o1); PY.setStderr(o2);
          }
          // junta stdout + retorno
          let combined = (buf || '');
          if (typeof ret === 'string') combined += ret;

          let parts = combined.split('__IMG__');
          const images = parts.slice(1).map(s => s.trim()).filter(s => s.length > 10);
          const text = (parts[0] || '').trim();

          if (text) out.textContent = text;
          else if (images.length) out.textContent = '(gráfico gerado)';
          else out.textContent = '(sem saída)';

          for (const b64 of images) {
            const img = new Image();
            img.src = 'data:image/png;base64,' + b64;
            img.style.maxWidth = '100%';
            img.loading = 'lazy';
            img.decoding = 'async';
            out.appendChild(img);
          }

          status.textContent = 'ok'; run.disabled = false;
        });
      });
    }

    attach(); boot();
  </script>
</body>
</html>
